{"title":"Bayesian Statistics","markdown":{"yaml":{"title":"Bayesian Statistics","format":"html","editor":"visual"},"headingText":"Computational Techniques","containsRefs":false,"markdown":"\n\n## Approximating Posterior Moments\n### Independent Monte Carlo\n\n```{r}\n#### Independent Monte Carlo ####\n## Data\nn <- 20\nsumy <- 40.4\nsumysq <- 93.2\nR <- 5e03\n## Posterior \nbetan <- sumy / (n + 1)\nan <- 2 + n / 2\nbn <- 2 + 0.5 * (sumysq - ((sumy ^ 2)) / (n + 1))\n## Independent Monte Carlo\nset.seed(12345)\nsigma.sq <- rep(NA, R)\nbeta <- rep(NA, R)\nfor(r in 1 : R){\n    sigma.sq[r] <- 1 / rgamma(n = 1, shape = an, rate = bn)\n    beta[r] <- rnorm(n = 1, mean = betan, sd = sqrt(sigma.sq[r] / (n + 1)))\n}\n## Plot the results\npar(mar = c(4.1, 4.1, 1.5, 1))\nplot(cumsum(beta) / (1 : R), type = \"l\", xlab = \"n\", ylab = \"Independent Monte Carlo approximation\")\nabline(h = sumy / (n + 1), col = 2, lty = 2, lwd = 2)\n```\n\n### Importance Sampling\n```{r}\n#### Importance Sampling ####\n## Data\nn <- 20\nsumy <- 40.4\nybar <- sumy / 20\nsumysq <- 93.2\nysd <- sqrt((sumysq - n * ybar ^ 2) / (n - 1))\n## Posterior \nbetan <- sumy / (n + 1)\nan <- 2 + n / 2\nbn <- 2 + 0.5 * (sumysq - ((sumy ^ 2)) / (n + 1))\n## Density of inverse-Gamma distribution\nIvGamma <- function(x, a, b){\n    exp(a * log(b) - lgamma(a) - (a + 1) * log(x) - b / x)\n} \n## Monte Carlo\nset.seed(123456)\nR <- 5e03\nh.pi.g <- rep(NA, R)\nfor(r in 1 : R){\n    ## We use Exp(1 / ybar) as the importance distribution\n    proposal <- rexp(n = 1, rate = 1 / ybar)\n    ## Compute the value of h(theta) * pi(theta | data) / g(theta)\n    h.pi.g[r] <- proposal * IvGamma(proposal, an, bn) / dexp(proposal, rate = 1 / ybar)\n}\n## Plot the results\npar(mar = c(4.1, 4.1, 1.5, 1))\nplot(cumsum(h.pi.g) / (1 : R), type = \"l\", xlab = \"n\", ylab = \"Importance Sampling\")\nabline(h = bn / (an - 1), col = 2, lty = 2, lwd = 2)\n```\n\n\n### Normalized Importance Sampling\n```{r}\n#### Normalized Importance Sampling ####\nset.seed(123456)\nw <- rep(NA, R)\nNIS <- rep(NA, R)\nfor(r in 1 : R){\n    ## Simulate sigma and beta\n    sigma.sq <- rexp(n = 1, rate = 1 / ybar)\n    beta <- rnorm(n = 1, mean = ybar, sd = ysd)\n    ## Compute the densities\n    posterior <- exp(-0.5 * ((n + 1) * beta ^ 2 - 2 * beta * sumy + 4 + sumysq) / sigma.sq) / (sigma.sq ^ (0.5 * (n + 1) + 3))\n    g.density <- dnorm(x = beta, mean = ybar, sd = ysd) * dexp(x = sigma.sq, rate = 1 / ybar)\n    ## normalized IS estimator\n    w[r] <- posterior / g.density\n    NIS[r] <- w[r] * sigma.sq\n}\n## Plot the results\npar(mar = c(4.1, 4.1, 1.5, 1))\nplot(cumsum(NIS) / cumsum(w), type = \"l\", xlab = \"n\", ylab = \"Normalized Importance Sampling\")\nabline(h = bn / (an - 1), col = 2, lty = 2, lwd = 2)\n```\n\n\n## Sampling from Posterior Distribution\n### Metropolis-Hastings Algorithm\n```{r}\n#### Metropolis-Hastings Algorithm ####\n## Data\nn <- 20\nsumy <- 40.4\nsumysq <- 93.2\nybar <- sumy / n\nysd <- sqrt((sumysq - n * ybar ^ 2) / (n - 1))\n## Define function for posterior density\nposterior <- function(beta, sigma.sq) {\n    exp(-0.5 * ((n + 1) * beta ^ 2 - 2 * beta * sumy + 4 + sumysq) / sigma.sq) / \n        (sigma.sq ^ (0.5 * (n + 1) + 3))\n}\n## Define function for Metropolis-Hastings algorithm\nMHalgorithm <- function(L, initial, sd) {   \n    # L is the length of the Markov chain, including the burn-in period\n    # initial is the initial state\n    # sd is the standard deviation of the proposal distribution for beta\n    chain <- rbind(c(initial), matrix(NA, L, length(initial)))\n    for(t in 1 : L){\n        # Propose a candidate\n        beta.prop <- rnorm(n = 1, mean = chain[t, 1], sd = sd)\n        sigmasq.prop <- rexp(n = 1, rate = 1 / chain[t, 2])\n        # Calculate the ratio\n        numerator <- posterior(beta = beta.prop, sigma.sq = sigmasq.prop) * \n            dnorm(x = chain[t, 1], mean = beta.prop, sd = sd) * \n            dexp(x = chain[t, 2], rate = 1 / sigmasq.prop)\n        denominator <- posterior(beta = chain[t, 1], sigma.sq = chain[t, 2]) * \n            dnorm(x = beta.prop, mean = chain[t, 1], sd = sd) * \n            dexp(x = sigmasq.prop, rate = 1 / chain[t, 2])\n        r <- numerator / denominator\n        # Generate U(0, 1)\n        u <- runif(1, 0, 1)\n        # Update\n        if(u <= r) {     \n            chain[t + 1, ] <- c(beta.prop, sigmasq.prop)\n        } else {     \n            chain[t + 1, ] <- chain[t, ]       \n        }\n    }\n    chain\n}\n## Perform MCMC sampling\nset.seed(12345)\nMH <- MHalgorithm(L = 20000, initial = c(0, 1), sd = 0.2) # sd is a tuning parameter\npar(mfrow = c(2, 1), mar = c(4.1, 4.1, 1.5, 1)) \nplot(MH[, 1], type = \"l\", ylab = expression(beta))  \nplot(MH[, 2], type = \"l\", ylab = expression(sigma^2))\n```\n\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"toc-depth":3,"number-sections":true,"output-file":"Bayes.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.2.335","theme":"cosmo","title":"Bayesian Statistics","editor":"visual"},"extensions":{"book":{"multiFile":true}}}}}